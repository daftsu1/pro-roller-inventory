# Traefik: proxy inverso + HTTPS (solo IP)
# Sin certs en ./certs, Traefik genera uno al vuelo; el navegador avisará y listo.
# Opcional: genera certs con scripts/generate-traefik-cert.sh y monta ./certs para uno fijo.

services:
  traefik:
    image: traefik:v2.11
    container_name: traefik
    restart: always

    command:
      - "--api.dashboard=true"
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entrypoints.web.address=:80"
      - "--entrypoints.websecure.address=:443"
      # Sin cert propio: Traefik usa cert autogenerado (aviso en el navegador)
      # Si tienes ./certs con cert.pem y key.pem, descomenta las 2 líneas de abajo:
      # - "--tls.stores.default.defaultcertificate.certfile=/certs/cert.pem"
      # - "--tls.stores.default.defaultcertificate.keyfile=/certs/key.pem"

    ports:
      - "80:80"
      - "443:443"
      - "8080:8080"

    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
      # - ./certs:/certs:ro   # descomenta si generaste certs con el script

    environment:
      - DOCKER_API_VERSION=1.44

    networks:
      - default

networks:
  default:
    name: traefik_default
